-- VALIDACION DE REPORTE COMISION ATM
SELECT * FROM GXOPERA.OPENTID; --FE 1
SELECT * FROM GXOPERA.OPMMARC; --FE 2
SELECT * FROM VIRGILILIB.OPMCATM;	--FE 3
SELECT * FROM GXBDBPS.TSWAUT;

Select /*LBINPR,LIDCOM,*/LTIPTR,lcodbc,LBCOCR/*,LBCOCR,LENEMI*/, COUNT(*) CANTIDAD,SUM(LIMPGS) IMPORTE
from libdebito.drconbep
where lfectr between '20210524' and '20210524' 
and lcodbc = 'DEB' and LBCOCR IN ('520')--('540','015','020') 
and ENEADM = '056'
and SUBSTR(DIGITS(lidcom), 6, 2) = '90' 
and lcretr = '00' and LENEMI <> ENEADM
and lesttr = 'A' and substr(lcodtr, 1, 2) = '01' --and ENEADM = '002'
GROUP BY /*LBINPR,LIDCOM,*/LTIPTR,lcodbc,LBCOCR/*,LBCOCR,LENEMI*/
ORDER BY /*LBINPR,LIDCOM,*/LTIPTR,lcodbc,LBCOCR/*,LBCOCR,LENEMI*/;


Select /*LBINPR,LIDCOM,*/ALTIPTR,Alcodbc,ALBCOCR/*,LBCOCR,LENEMI*/, COUNT(*) CANTIDAD,SUM(ALIMPGS) IMPORTE
from VIRGILILIB.drcon180
where Alfectr between '20210524' and '20210524' 
and Alcodbc = 'DEB' and ALBCOCR IN ('520')--('540','015','020') 
and AENEADM = '002'
and SUBSTR(DIGITS(Alidcom), 6, 2) = '90' 
and Alcretr = '00' and ALENEMI <> AENEADM
and Alesttr = 'A' and substr(Alcodtr, 1, 2) = '01' --and ENEADM = '002'
GROUP BY /*LBINPR,LIDCOM,*/ALTIPTR,Alcodbc,ALBCOCR/*,LBCOCR,LENEMI*/
ORDER BY /*LBINPR,LIDCOM,*/ALTIPTR,Alcodbc,ALBCOCR/*,LBCOCR,LENEMI*/;

SELECT CATARJE AS BIN,CACOMER/*,CAENEMI,CAPROCE,CACODAD*/, SUM(CACANAD) AS CANTIDAD,
SUM(CAIMPOR) IMPORTE
from GXOPERA.OPMCATM
WHERE CAFECHA = '20210201' 
AND CACODAD = '581'
AND CAMARCA = 'MST'--'VSA'
AND CAPROCE IN ('530')--('540','015','020')
AND CAENEMI <> '581'
group by  CATARJE,CACOMER/*,CAENEMI,CAPROCE,CACODAD*/
ORDER BY CATARJE,CACOMER/*,CAENEMI,CAPROCE,CACODAD*/;

CREATE INDEX GXOPERA.UOPMMARC2 ON 
	GXOPERA.OPMMARC (MACOBC ASC,MACOCR ASC); 
CREATE INDEX VIRGILILIB.UDRCONBP2 ON 
VIRGILILIB.DRCONBEP (ENEADM,lfectr,lcodbc,lcretr,LENEMI,LBCOCR)
CREATE INDEX VIRGILILIB.UDRCONBP1 ON 
VIRGILILIB.DRCONBEP (ENEPRO,lfectr,lcodbc,lcretr,LENEMI,LBCOCR)

SELECT * FROM VIRGILILIB.OPMMARC;
select * from virgililib.tbinproc;
select * from gxopera.tbineaf;

SELECT CATARJE, COUNT(*)
FROM VIRGILILIB.OPMCATM
WHERE CAFECHA BETWEEN '20210201' AND '20210524';

SELECT CATARJE, COUNT(*)
FROM VIRGILILIB.OPMCATM
WHERE CAFECHA BETWEEN '20210201' AND '20210524'
AND NOT CATARJE IN (SELECT PBIN FROM VIRGILILIB.TBINPROC)
GROUP BY CATARJE
ORDER BY CATARJE;

select SUBSTR(BINNROBIN,1,6),BINIDMARCA,BINAMBUSO from virgililib.tdgbin
WHERE SUBSTR(BINNROBIN,1,6) IN ( SELECT CATARJE FROM VIRGILILIB.OPMCATM WHERE CAFECHA BETWEEN '20210201' AND '20210524'
AND NOT CATARJE IN (SELECT PBIN FROM VIRGILILIB.TBINPROC) GROUP BY CATARJE ORDER BY CATARJE)
GROUP BY  SUBSTR(BINNROBIN,1,6),BINIDMARCA,BINAMBUSO
ORDER BY  SUBSTR(BINNROBIN,1,6),BINIDMARCA,BINAMBUSO;

SELECT * FROM VIRGILILIB.TBINPROC where pbin in 
('400123','404942','409602','410626','414909','415282','429480','446292','453128','453997',
'455510','455511','456997','462087','476164','478340','482481','490985','496617','497578',
'516794','517332','535146','535228','535456','536154','537389','540303','555788','557355',
'557475','639096','670385','671020','671069','671070','671076','671078','671080','671081',
'672213','672216','672217','672220','672241','672242','672243','672244','672247','672248',
'672285','672286','672515','672518','672520','672521','672522','672523','672525','672526',
'672528','672530','672533','672534','672540','672541','672550','672553','672558','672560',
'672566','672567','672568','672569','672571','672572','672580','672586','672587','672612',
'672664','672666','672670','672673','672677','678865');
SELECT * FROM VIRGILILIB.OPMCATM WHERE CAFECHA BETWEEN '20210201' AND '20210524'
AND CATARJE IN ('400123','404942','409602','410626','414909','415282','429480','446292','453128','453997',
'455510','455511','456997','462087','476164','478340','482481','490985','496617','497578',
'516794','517332','535146','535228','535456','536154','537389','540303','555788','557355',
'557475','639096','670385','671020','671069','671070','671076','671078','671080','671081',
'672213','672216','672217','672220','672241','672242','672243','672244','672247','672248',
'672285','672286','672515','672518','672520','672521','672522','672523','672525','672526',
'672528','672530','672533','672534','672540','672541','672550','672553','672558','672560',
'672566','672567','672568','672569','672571','672572','672580','672586','672587','672612',
'672664','672666','672670','672673','672677','678865');

select CAFECHA,CACOMER,CAPROCE,CAENEMI,CATARJE,CAMARCA,count(*)
FROM VIRGILILIB.OPMCATM 
WHERE CAFECHA BETWEEN '20210201' AND '20210524'
GROUP BY CAFECHA,CACOMER,CAPROCE,CAENEMI,CATARJE,CAMARCA
ORDER BY CAFECHA,CACOMER,CAPROCE,CAENEMI,CATARJE,CAMARCA;

SELECT * FROM virgililib.tdgbin;


select count(*) from gxweb.drcon180                                 
              where alfectr >= '20210501' and alfectr <= '20210531' ----2.802.915;

