-------------------------------------
SELECT LERRNB, lcretr, COUNT(*) FROM LIBDEBITO.DRCONBEP
WHERE LFECTR = 20221208
GROUP BY lcretr ,LERRNB HAVING COUNT(*)>1;

SELECT opfecom, opliqde, substr(OPTARJ, 1, 6), openemi, count(*), sum(OPMONTO - OPCOMI - OPRENTA-OPREIVA)
FROM GXOPERA.OPMOVI WHERE OPLIQDE='20221111' AND OPCOMER='0801771'
GROUP BY opfecom, opliqde,substr(OPTARJ, 1, 6), OPENEMI;

SELECT * FROM GXOPERA.OPMOVI WHERE OPCOMER='0801771' AND OPFECOM='20221111';

SELECT * FROM GXOPERA.FLICOM1 WHERE LIFECHD='20221111' AND LICOMER='0801771';
SELECT * FROM GXOPERA.FLICOM1 WHERE LIFECREDI='20221111' AND LICOMER='0801771';
------------------------------------------------------------------------------------------------
SELECT opfecom, opliqde, substr(OPTARJ, 1, 6), openemi, count(*), sum(OPMONTO - OPCOMI - OPRENTA-OPREIVA)
FROM GXOPERA.OPMOVI WHERE OPLIQDE='20221201' AND OPCOMER='0701733'
GROUP BY opfecom, opliqde,substr(OPTARJ, 1, 6), OPENEMI;

SELECT * FROM GXOPERA.FLICOM1 WHERE LIFECHD='20221201' AND LICOMER='0701733';
SELECT * FROM GXOPERA.FLICOM1 WHERE LIFECREDI='20221205' AND LICOMER='0701733';
-------------------------------------------------------------------------------------------------
SELECT * FROM GXFINDTA.TCLTSD WHERE TSDNREF IN ('228705923099',
'228705922968');
SELECT * FROM LIBDEBITO.DRCONBEP WHERE LERRNB                                        IN (
'228705923099',
'228705922968');

SELECT * FROM LIBDEBITO.DRCONBEP WHERE LERRNB IN ('229407621416',
'229407622396','229407621702','229407621162','229407621618',
'229407622481','229407621453');

SELECT * FROM GXOPERA.OPENTID1 WHERE ENTCODI='174';
SELECT * FROM GXOPERA.TCLSEC WHERE --para ver si se pgag en linea
/*UPDATE LIBDEBITO.DRCONBEP SET LENEMI='002' WHERE LERRNB ='226697985449';
UPDATE LIBDEBITO.PRUEBCLR SET LENEMI='002' WHERE LERRNB ='226697985449';*/
--DELETE FROM;
           select * from LIBDEBITO.PRUEBCLR WHERE LERRNB='286800002242'
SELECT * FROM GXBDBPS.TSWAUT WHERE AUTRRNBEP IN ('229407621416',
'229407622396',
'229407621702',
'229407621162',
'229407621618',
'229407622481',
'229407621453');
SELECT * FROM GXBDBPS.TSWAUT WHERE AUTRRNBEP IN (
'229407621416',
'229407622396',
'229407621702',
'229407621162',
'229407621618',
'229407622481',
'229407621453');


SELECT * FROM GXFINDTA.TCLMOV WHERE MOVRRNBEP IN ('229407621416',
'229407622396',
'229407621702',
'229407621162',
'229407621618',
'229407622481',
'229407621453');
SELECT * FROM GXOPERA.OPLIQUI WHERE OPNROREF IN ('229407621416',
'229407622396',
'229407621702',
'229407621162',
'229407621618',
'229407622481',
'229407621453');
SELECT * FROM GXOPERA.OPMOVI WHERE OPNOREF IN ('229407621416',
'229407622396',
'229407621702',
'229407621162',
'229407621618',
'229407622481',
'229407621453');
sELECT *
FROM gxfindta.tcltsb
WHERE tsbnref IN ('229407621416',
'229407622396',
'229407621702',
'229407621162',
'229407621618',
'229407622481',
'229407621453');

229407622396
-----------------------------------------------caso retail 42368
    -- caso reversa
SELECT * FROM GXOPERA.OPMOVI WHERE OPNOREF IN (
'233420870549',
'233420888623',
'233420871474',
'233420871648');
SELECT * FROM GXOPERA.OPLIQUI WHERE OPNROREF IN (
'233420870549',
'233420888623',
'233420871474',
'233420871648');
sELECT *
FROM gxfindta.tcltsb WHERE tsbnref IN ('233420870549',
'233420888623',
'233420871474',
'233420871648');
SELECT * FROM GXFINDTA.TCLTSD WHERE TSBIDOP IN (5341545,
5341631)
--llamar al 28
CALL PGM(GXFINPGM/PCLR028) PARM('22113007939559' '233420870549   ' '20221130');
CALL PGM(GXFINPGM/PCLR028) PARM('22113007940003' '233420888623   ' '20221130');
CALL PGM(GXFINPGM/PCLR028) PARM('22113007939550' '233420871474   ' '20221130');
CALL PGM(GXFINPGM/PCLR028) PARM('22113007939557' '233420871648   ' '20221130');
    ---caso 2
SELECT * FROM GXOPERA.OPMOVI WHERE OPNOREF IN ('232918674908','232517590593','232918810077','232818262633','233018947513','233119435043');
SELECT * FROM GXOPERA.OPLIQUI WHERE OPNROREF IN ('232918674908','232517590593','232918810077','232818262633','233018947513','233119435043');
sELECT * FROM gxfindta.tcltsb WHERE tsbnref IN ('232918674908','232517590593','232918810077','232818262633','233018947513','233119435043');
CALL PGM(GXFINPGM/PCLR028) PARM('22112107891197' '232517590593   ' '20221121');
CALL PGM(GXFINPGM/PCLR028) PARM('22112407902929' '232818262633   ' '20221124');
CALL PGM(GXFINPGM/PCLR028) PARM('22112507908206' '232918674908   ' '20221125');
CALL PGM(GXFINPGM/PCLR028) PARM('22112507909623' '232918810077   ' '20221125');
CALL PGM(GXFINPGM/PCLR028) PARM('22112607911469' '233018947513   ' '20221128');
CALL PGM(GXFINPGM/PCLR028) PARM('22112707921898' '233119435043   ' '20221128');
    ---caso3
SELECT * FROM GXOPERA.OPMOVI WHERE OPNOREF IN ('292300038494','292400039965','292100037310','291900035729','291900035738','292900044267'); --se cambia la fecha liq desde y hasta al 20010101 995 dinelco efectivo
UPDATE GXOPERA.OPMOVI SET OPLIQDE='20010101', OPLIQHA='20010101', OPCOMER='8100927' WHERE OPNOREF ='293300048287';
UPDATE GXOPERA.OPMOVI SET OPLIQDE='20010101', OPLIQHA='20010101', OPCOMER='8100948' WHERE OPNOREF ='291900035738';
UPDATE GXOPERA.OPMOVI SET OPLIQDE='20010101', OPLIQHA='20010101', OPCOMER='8100948' WHERE OPNOREF ='292100037310';
UPDATE GXOPERA.OPMOVI SET OPLIQDE='20010101', OPLIQHA='20010101', OPCOMER='8100875' WHERE OPNOREF ='292300038494';
UPDATE GXOPERA.OPMOVI SET OPLIQDE='20010101', OPLIQHA='20010101', OPCOMER='8100875' WHERE OPNOREF ='292400039965';
UPDATE GXOPERA.OPMOVI SET OPLIQDE='20010101', OPLIQHA='20010101', OPCOMER='8100948' WHERE OPNOREF ='292900044267';
--ya no se le va a calcualr el comisionamiento debido a que al momento de la autorizaci√≥n se registro de manera incorrectoa
--se regulaizara los importes transaccionales directamente
SELECT * FROM GXBDBPS.COMA1AF WHERE COCOMER IN ('0703692','0701448',
'0700534','0701733') AND PRCODI='995';
0700534,6,995,8100875
0701733,5,995,8100948
0703692,2,995,8102705

SELECT * FROM GXOPERA.OPLIQUI WHERE OPNROREF IN ('292300038494','292400039965','292100037310','291900035729','291900035738','292900044267');
SELECT * FROM GXOPERA.OPLIQUI WHERE substr(OPCAMPOA, 41, 8)='20221111' AND OPNCOMER='0701353';
SELECT * FROM GXOPERA.FLICOM1 WHERE LICOMER in('8102705') AND LIFECHD='20221115';
--caso 3.1
SELECT * FROM GXFINDTA.TCLIMB WHERE IMBIDOP='223150010701353';
SELECT *--sum(movneto)
FROM  GXFINDTA.TCLMOV WHERE MOVIDLT='223150010701353';
SELECT * FROM GXOPERA.OPMOVI WHERE OPCOMER='0701353' AND OPFECOM='20221111';

SELECT opfecom, opliqde, OPCODTRN, substr(OPTARJ, 1, 6), openemi, count(*), sum(OPMONTO - OPCOMI - OPRENTA-OPREIVA)
FROM GXOPERA.OPMOVI WHERE OPLIQDE='20221111' AND OPCOMER='0701353'
GROUP BY opfecom, opliqde,OPCODTRN, substr(OPTARJ, 1, 6), OPENEMI;
--VER PARA COMENTAR PORQUE SE PAGO DE MAS
SELECT * FROM GXOPERA.FLICOM1 WHERE LICOMER='0701353' AND LIFECREDI='20221114';

SELECT * FROM GXOPERA.OPMOVI WHERE OPNOREF='229407622396'

SELECT * FROM GXBDBPS.COMA1AF WHERE COCOMER= '0701353' AND PRCODI='995';
0701353,5,995,8100926
UPDATE GXOPERA.OPMOVI SET OPLIQDE='20010101', OPLIQHA='20010101', OPCOMER='8100926' WHERE OPNOREF ='291500031354';
--CASO4
SELECT * FROM GXFINDTA.TCLIMB WHERE IMBIDOP='223340010703692'
SELECT opfecom, opliqde, OPCODTRN, substr(OPTARJ, 1, 6), openemi, count(*), sum(OPMONTO - OPCOMI - OPRENTA-OPREIVA)
FROM GXOPERA.OPMOVI WHERE OPLIQDE='20221130' AND OPCOMER='0703692'
GROUP BY opfecom, opliqde,OPCODTRN, substr(OPTARJ, 1, 6), OPENEMI;
SELECT * FROM GXOPERA.OPLIQUI WHERE OPNCOMER='0703692' AND substr(OPCAMPOA, 41, 8)='20221130';
SELECT * FROM GXOPERA.FLICOM1 WHERE LICOMER='0703692' AND LIFECREDI='20221201';

SELECT * FROM GXOPERA.OPMOVI WHERE OPNOREF='233421368305';
---------------------------------------------------------
--reversada retail
CORRECCIONES TC REVERSADAS BEPSA Y APROBADAS POR LA MARCA
1-aprobar la trx en drconbep y tswaut
UPDATE LIBDEBITO.DRCONBEP SET LESTTR = 'A' WHERE LERRNB in ('303347365754','303347382688');
UPDATE GXBDBPS.TSWAUT SET AUTTRXESTF = 'A' WHERE AUTRRNBEP in ('303347365754','303347382688');

2- UPDATE EN GXBDBPS.TMCTAAF (SE VERIFICA QUE NO TIENE AFECTACION EN EL CLIENTE);
UPDATE GXBDBPS.TMCTAAF SET MCAPCOC=MCAPCOC+227635, MCAUTPE=MCAUTPE+227635 WHERE MCNUMCT = '388008694';
UPDATE GXBDBPS.TMCTAAF SET MCAPCOC=MCAPCOC+64050, MCAUTPE=MCAUTPE+64050 WHERE MCNUMCT = '388012053';

3- Modificar fecha de incoming para que cargue en opmovi
UPDATE GXBDBPS.TSWAUT SET AUTFECINC = '2023-02-21 00:00:00.000' where AUTRRNBEP in ('303347365754','303347382688');

4- Modificar fecha comercial para que cargue tclmov
UPDATE GXBDBPS.TSWAUT SET AUTTRXFCHC = '20230221',AUTESTCLE = 'P' where AUTRRNBEP in ('303347365754','303347382688');
estadcup debe estar P
estadoCle debe estar P
----------------------------------------------------------------------------
/*DETALLE DE TRANSACCIONES BEPSA*/
Select opferea fecha_real,opfecom fecomercial, opliqde Feliquidacion, opnoref Referencia,OPRADOR OPERADOR, ENTCODCOM COMEREMI,openemi Emisor,ENTNMENTID DESEMISOR, ENCENTACT EMISORNEW,  (SELECT ENEMISO FROM GXBDBPS.COMAEAF WHERE COCOMER = ENTCODCOM)BCOEMISOR,OPCOMER Comercio,  B.COCOMER COENTIDAD, opadmin Administrador,ennombr dENOMINACION, B.ENEMISO BANCOPAGADOR, PARBCOPAI BCOPAGADORNEW,
opcodtrn Transaccion,  TXDTRX DESCRIPCION,opstatus estado,lcodbc marca,optiptar tipo_tarj,lnfisc adq,entbina producto,
 (case when lmarca = 'L' then  'LOCAL'  when lmarca = 'I' then  'INTERNACIONAL'  when lmarca = 'R' then  'INTERCOUNTRY'  when lmarca = 'E' then  'EXTRANJERO'    ELSE '' END) ambito,
    (case when LNFISC in ('443073','472040') THEN 'BANCARD' when LNFISC = '449780' THEN 'BNF' when LNFISC ='461958' THEN 'AUSTRALIA' when LNFISC ='459834' THEN 'MILAN ITALIA' END) descrip_amb,
 (Case when substr(opidtra,1,1) = 'T' then 'ATM' when  substr(opidtra,1,1) = 'A' then 'APP' else 'POS' end) Dispo, substr(optarj,1,6)BIN,
(CASE WHEN SECENBCO= 'S'  THEN 'ONLINE' ELSE 'BATCH' END) TIPOOPERACION,
opmonto Monto, opcomi Comision,  opcoment COMIENT, opcombps COMIBPS, opivaent IVAENTI, opivabps IVABPS, OPRENTA RENTA, OPREIVA IVARENTA
from gxopera.opmovi
left join libdebito.drconbep x on lerrnb = opnoref and substr(digits(lidcom), 6, 7)= opcomer
left join gxopera.opentid1 on entcodi = openemi and substr(entbin,1,6) = substr(optarj,1,6)
INNER JOIN GXBDBPS.COMAEAF B ON OPCOMER = COCOMER
left JOIN gxbdbps.gentiaf A ON opadmin = A.enemiso
LEFT JOIN GXOPERA.TCLSEC ON OPENEMI = SECCOEM AND SUBSTR(OPTARJ,1,6) = SUBSTR(SECENBIN,1,6) AND OPCODTRN = SECCOTRX AND SECCOBCO = B.ENEMISO
INNER JOIN LIBDEBITO.TBCTRA0P ON OPCODTRN = TXCTRX
LEFT JOIN GXTRJDTA.TCOENC ON OPENEMI = ENCENTANT AND SUBSTR(ENCENTROL,5,2) = '01'
LEFT JOIN GXTRJDTA.TDGENT ON ENCENTACT = ENTCODENT
LEFT JOIN GXOPERA.CLPARF ON B.ENEMISO = PARCODBCO
where opfecom between '20230201' and '20230224'
AND SUBSTR(OPIDTRA,1,1) <> 'T'
union
/*OPMOVI - (Detalle ATM)*/
Select  opferea fecha_real,opfecom fecomercial, opliqde Feliquidacion,opnoref Referencia,OPRADOR OPERADOR,  ENTCODCOM COMEREMI,openemi Emisor,ENTNMENTID DESEMISOR, ENCENTACT EMISORNEW, (SELECT ENEMISO FROM GXBDBPS.COMAEAF WHERE COCOMER = ENTCODCOM)BCOEMISOR,OPCOMER Comercio,  B.COCOMER COENTIDAD, opadmin Administrador,ennombr dENOMINACION, B.ENEMISO BANCOPAGADOR,  PARBCOPAI BCOPAGADORNEW,
opcodtrn Transaccion,  TXDTRX DESCRIPCION, opstatus estado,lcodbc marca,optiptar tipo_tarj,lnfisc adq,entbina producto,
 (case when lmarca = 'L' then  'LOCAL'  when lmarca = 'I' then  'INTERNACIONAL'  when lmarca = 'R' then  'INTERCOUNTRY'  when lmarca = 'E' then  'EXTRANJERO'    ELSE '' END) ambito,
    (case when LNFISC in ('443073','472040') THEN 'BANCARD' when LNFISC = '449780' THEN 'BNF' when LNFISC ='461958' THEN 'AUSTRALIA' when LNFISC ='459834' THEN 'MILAN ITALIA' END) descrip_amb,
(Case when substr(opidtra,1,1) = 'T' then 'ATM' when  substr(opidtra,1,1) = 'A' then 'APP' else 'POS' end) Dispo, substr(optarj,1,6)BIN,
'BATCH' TIPOOPERACION,
opmonto Monto, opcomi Comision,  opcoment COMIENT, opcombps COMIBPS, opivaent IVAENTI, opivabps IVABPS, OPRENTA RENTA, OPREIVA IVARENTA
from gxopera.opmovi
left join libdebito.drconbep x on lerrnb = opnoref and substr(digits(lidcom), 6, 7)= opcomer
left join gxopera.opentid1 on entcodi = openemi and substr(entbin,1,6) = substr(optarj,1,6)
INNER JOIN GXBDBPS.COMAEAF B ON opadmin = coenadm and substr(cocomer,1,2) = '45' AND COSTAT = 0 AND COENADM <> '999'
left JOIN gxbdbps.gentiaf A ON opadmin = A.enemiso INNER JOIN LIBDEBITO.TBCTRA0P ON OPCODTRN = TXCTRX
LEFT JOIN GXTRJDTA.TCOENC ON OPENEMI = ENCENTANT AND SUBSTR(ENCENTROL,5,2) = '01'
LEFT JOIN GXTRJDTA.TDGENT ON ENCENTACT = ENTCODENT
LEFT JOIN GXOPERA.CLPARF ON B.ENEMISO = PARCODBCO
where opfecom between '20230201' and '20230224'
AND SUBSTR(OPIDTRA,1,1) = 'T';